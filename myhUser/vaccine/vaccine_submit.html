<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="format-detection" content="telephone=no">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>填写资料</title>
		<link rel="stylesheet" href="../css/mui.min.css" />
		<style>
			.main-font-color,
			header .mui-icon.mui-icon-left-nav,
			.mui-icon-reload {
				color: #33A2D7 !important
			}
			
			.mui-bar {
				background-color: #fff;
			}
			
			.mui-bar-nav {
				top: 0;
				-webkit-box-shadow: 0 1px 6px #ccc;
				box-shadow: 0 1px 6px transparent;
				border-bottom: 1px solid #DEDEDE
			}
			
			.mui-bar .mui-title {
				right: 40px;
				left: 40px;
				display: inline-block;
				overflow: hidden;
				width: auto;
				margin: 0;
				text-overflow: ellipsis;
				color: #33A2D7;
				font-size: 17px !important
			}
			
			body {
				background-color: #efeff4 !important
			}
			
			.div_btn_add {
				margin: 15px auto;
				width: 70%;
			}
			
			.div_btn_add button {
				width: 100%;
			}
			
			label,
			input {
				font-size: 15px;
			}
			
			.mui-table-view:before,
			.mui-table-view:after {
				height: 0;
			}
			
			.div_btn_add .mui-btn.mui-btn-blue {
				padding: 6px 12px 2px;
			}
			
			.mui-icon-plus:before {
				position: relative;
				bottom: 1px;
				right: 5px;
			}
			
			.mui-table-view-cell {
				padding: 0;
				margin: 10px 0 0;
			}
			
			.mui-table-view-chevron .mui-table-view-cell {
				padding-right: 10px;
			}
			
			.mui-table-view .mui-media-object {
				line-height: 80px;
				max-width: 120px;
				height: 80px;
			}
			
			#vaccineName {
				font-size: 15px;
				min-height: 60px;
				word-break: break-all;
			}
			
			.mui-card {
				border: 0;
			}
		</style>
		<script>
			//检查手机号
			function checkPhone(phone) {
				if(!util.checkPhone(phone)) {
					mui.toast('请正确填写联系电话')
				}
			}
			//检查身份证号
			function checkCardId(val) {
				if(!util.checkCardId(val)) {
					mui.toast('请正确填写身份证号码')
				}
			}
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">填写资料</h1>
			<button id="submit" class="mui-btn mui-btn-blue mui-btn-link mui-pull-right" style="border: 0;">提交</button>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view mui-table-view-chevron" style="margin: 10px;">
				<li class="mui-table-view-cell mui-media" style="padding:10px;border-radius: 6px;">
					<img id="thumbnailImg" class="mui-media-object mui-pull-left" src="../images/default-record.png">
					<div class="mui-media-body">
						<div id="vaccineName">疫苗名称</div>
						<p class="main-font-color">定金: ¥<span id="price">0.00</span><span class="mui-pull-right">x1</span></p>
					</div>
				</li>
			</ul>
			<div class="mui-card">
				<ul id="divForm" class="mui-table-view">
					<li class="mui-table-view-cell">
						<div class="mui-slider-right mui-disabled">
							<a class="mui-btn mui-btn-red">删除</a>
						</div>
						<div class="mui-slider-handle">
							<form class="mui-input-group">
								<div class="mui-input-row">
									<label>到诊人</label>
									<input type="text" maxlength="10" class="mui-input-clear name" placeholder="请输入到诊人">
								</div>
								<div class="mui-input-row">
									<label>联系电话</label>
									<input type="tel" maxlength="11" class="mui-input-clear tel" placeholder="请输入联系电话" onblur="checkPhone(this.value)">
								</div>
								<div class="mui-input-row">
									<label>身份证号码</label>
									<input type="tel" class="mui-input-clear card" maxlength="20" placeholder="接种人身份证号码" onblur="checkCardId(this.value)">
								</div>
							</form>
						</div>
					</li>
				</ul>
			</div>
			<div class="div_btn_add"><button id='addBtn' type="button" class="mui-btn mui-btn-blue mui-icon mui-icon-plus">添加</button></div>
		</div>
	</body>
	<script src="../js/mui.min.js"></script>
	<script src="../js/common.js"></script>
	<script>
		(function(_, doc, u, w) {
			_.init(), _(".mui-scroll-wrapper").scroll();
			var vaccinumId = null,
				inputItmems = null,
				thumbnailImg = '';
			var divFormObj = document.getElementById("divForm"),
				submitObj = document.getElementById("submit");

			w.addEventListener("event", function(e) {
				privateToken = w.getItem("privateToken");
				vaccinumId = e.detail.vaccinumId;
				name = e.detail.name;
				price = e.detail.price;
				thumbnailImg = e.detail.thumbnailImg || '../images/default-record.png';
				document.getElementById("thumbnailImg").setAttribute('src', thumbnailImg);
				document.getElementById("price").innerHTML = price;
				console.log(JSON.stringify(e.detail));
				document.getElementById("vaccineName").innerHTML = name;

			})

			_.plusReady(function() {
				//				privateToken = w.getItem("privateToken");
				//				web = plus.webview.currentWebview();
				//				vaccinumId = web.vaccinumId;
				//				name = web.name;
			})

			//添加接种人信息
			document.getElementById("addBtn").addEventListener('tap', function() {
				inputItmems = divFormObj.querySelectorAll('input');
				if(inputItmems && inputItmems.length > 0) {
					for(var i = 0; i < inputItmems.length; i++) {
						if(u.isNull(inputItmems[i].value)) {
							_.toast('请补充完整到诊人信息');
							return;
						}
					}
				}
				var liItem = document.createElement('li');
				liItem.classList = 'mui-table-view-cell';
				liItem.innerHTML = '<div class="mui-slider-right mui-disabled">' +
					'<a class="mui-btn mui-btn-red">删除</a>' +
					'</div>' +
					'<div class="mui-slider-handle">' +
					'<form class="mui-input-group">' +
					'<div class="mui-input-row">' +
					'<label>到诊人</label>' +
					'<input type="text"  maxlength="10" class="mui-input-clear name" placeholder="请输入到诊人">' +
					'</div>' +
					'<div class="mui-input-row">' +
					'<label>联系电话</label>' +
					'<input type="tel" maxlength="11" class="mui-input-clear tel" placeholder="请输入联系电话" onblur="checkPhone(this.value)">' +
					'</div>' +
					'<div class="mui-input-row">' +
					'<label>身份证号码</label>' +
					'<input type="tel" class="mui-input-clear card" maxlength="20" placeholder="接种人身份证号码" onblur="checkCardId(this.value)">' +
					'</div>' +
					'</form>' +
					'</div>';
				divFormObj.appendChild(liItem);
			})

			//提交
			submitObj.addEventListener('tap', function() {
				inputItmems = divFormObj.querySelectorAll('input');
				if(inputItmems && inputItmems.length > 0) {
					for(var i = 0; i < inputItmems.length; i++) {
						if(u.isNull(inputItmems[i].value)) {
							_.toast('请补充完整接种人信息');
							return;
						}
					}
				}

				var names = document.getElementsByClassName('name');
				var tels = document.getElementsByClassName('tel');
				var cards = document.getElementsByClassName('card');

				var namesArr = [],
					telsArr = [],
					cardsArr = [];
				for(var i = 0; i < names.length; i++) {
					namesArr.push(names[i].value);
					console.log('namesArr=====' + namesArr[i]);
				}
				for(var i = 0; i < tels.length; i++) {
					telsArr.push(tels[i].value);
					console.log('telsArr=====' + telsArr[i]);
				}
				for(var i = 0; i < cards.length; i++) {
					cardsArr.push(cards[i].value);
					console.log('cardsArr=====' + cardsArr[i]);
				}
			})

			_('#divForm').on('tap', '.mui-btn', function(event) {
				var elem = this;
				var li = elem.parentNode.parentNode;
				_.confirm('确认删除该条记录？', '提示', ['确认', '取消'], function(e) {
					if(e.index == 0) {
						li.parentNode.removeChild(li);
					} else {
						setTimeout(function() {
							_.swipeoutClose(li);
						}, 0);
					}
				});
			});
		})(mui, document, util, window)
	</script>

</html>