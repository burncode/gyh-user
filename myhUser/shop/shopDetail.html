<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="format-detection" content="telephone=no">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>详情</title>
		<link rel="stylesheet" href="../css/mui.min.css" />
		<link rel="stylesheet" href="../css/common.css" />
		<link rel="stylesheet" href="../css/icons-extra/icons-extra.css" />
		<!--<link rel="stylesheet" href="../css/detail.css" />-->
		<style>
			.mui-bar-tab {
				height: 44px;
			}
			
			.detail-btn-pay,
			.detail-btn-cart {
				line-height: 32px;
				width: 50%;
				border: 0;
				border-radius: 0;
			}
			
			.detail-btn-pay {
				background-color: #CF2D28;
				color: #fff;
			}
			
			.detail-btn-cart {
				background-color: #33A2D7;
				color: #fff;
			}
			
			.badge-pos {
				position: absolute;
				top: 6px;
				right: 5px;
			}
			
			.mui-bar .mui-btn-link {
				font-size: 25px;
			}
			
			.mui-content {
				background-color: #fff;
			}
			
			.info-title {
				text-align: center;
				margin: 10px 0 0;
			}
			
			.info-content {
				width: 95%;
				margin: 0 auto;
				overflow: hidden;
				font-size: 14px;
				margin-bottom: 30px;
				color: #666;
				line-height: 24px
			}
		</style>
	</head>

	<body>
		<div id="app">
			<header class="mui-bar mui-bar-nav">
				<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
				<h1 class="mui-title">详情</h1>
				<a class="mui-icon-extra mui-icon-extra-cart mui-btn-link mui-pull-right" @tap="toCart()">
					<span v-if="cartNum > 0" class="mui-badge mui-badge-danger badge-pos">{{cartNum}}</span>
				</a>
			</header>
			<nav class="mui-bar mui-bar-tab">
				<button type="button" class="detail-btn-cart" @tap="addToCart()">加入购物车</button>
				<button type="button" class="detail-btn-pay" @tap="toBuy()">立即购买</button>
			</nav>
			<div class="mui-content">
				<div class="info-title">{{name}}</div>
				<!--<div class="info-title">{{frice}}</div>-->
				<div class="info-content" v-html="detail"></div>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../js/mui.min.js"></script>
	<script type="text/javascript" src="../js/vue.min.js"></script>
	<script type="text/javascript" src="../js/common.js"></script>
	<script>
		(function(_, doc, u, w) {
			_.init();
			var app = new Vue({
				el: "#app",
				data: {
					cartNum: 0,
					name: '',
					frice: 0.00,
					detail: ''
				},
				mounted: function() {
					var self = this;
					var pdata = {
						privateToken: w.getItem("privateToken"),
						geneId: '23'
					}
					_.plusReady(function() {
						u.mypost("gene_check/geneCheckDetail", pdata, true, function(data) {
							if(data.code == 0) {
								data = data.data[0][0];
								name = data ? data.name : '';
								detail = data ? data.detail : nodataHtmlInfo;
								price = data ? data.price : '0.0';
								self.name = name;
								//							self.price = price;
								self.detail = detail;
							} else if(data.code == 500 && '未登錄' == data.msg) {
								u.goLogin();
							}
						}, myerror);
					})
				},
				methods: {
					addToCart: function() { //添加到购物车
						_.toast("成功加入购物车");
						this.cartNum++;
					},
					toBuy: function() {
						//						if(!w.getUser()){
						//							w.openView("../userLogin.html");
						//						}else{
						//							pdata.privateToken = w.getItem("privateToken");
						//							pdata.geneId = geneId;
						//							u.mypost("gene_check/payView",pdata,true,function(data){
						//								if(data.code == 0){
						//									orderId = data.data.orderId;
						//									var ex = {
						//										type:3,
						//										order_type:"基因檢測專業咨詢服務費",
						//										orderId:orderId,
						//										fee:price
						//									}
						//									w.openView("../doctor/pay.html",ex);//1代表直接支付，并跳转到購買成功
						//								}else if(data.code == 500 && '未登錄' == data.msg){
						//									u.goLogin();
						//								}
						//							},myerror);
						//						}
						w.openView("confirmOrder.html");
					},
					toCart: function() {
						w.openView("cart.html")
					}
				}
			})

			//			var data = null,
			//				name = null,
			//				detail = null,
			//				price = null,
			//				geneId = null;
			//			var pdata = {},
			//				payObj = doc.getElementById("pay");
			//			var orderId = null,
			//				privateToken = null,
			//				web = null;
			//			_.plusReady(function() {
			//				//				privateToken = w.getItem("privateToken");
			//				//				web = plus.webview.currentWebview();
			//				//				geneId = web.geneId;
			//				//				pdata.geneId = geneId;
			//				//				u.mypost("gene_check/geneCheckDetail",pdata,true,function(data){
			//				//					if(data.code == 0){
			//				//						data = data.data[0][0];
			//				//						name = data?data.name:'';
			//				//						detail = data?data.detail:nodataHtmlInfo;
			//				//						price = data?data.price:'0.0';
			//				//						doc.getElementById("name").innerHTML = name;
			//				//						doc.getElementById("price").innerHTML = price;
			//				//						doc.getElementById("detail").innerHTML = detail;
			//				//					}else if(data.code == 500 && '未登錄' == data.msg){
			//				//						u.goLogin();
			//				//					}else{
			//				//						detail = data?data.detail:nodataHtmlInfo;
			//				//					}
			//				//				},myerror);
			//			})
		})(mui, document, util, window)
	</script>

</html>